<!-- Common demo imports -->
<link rel="import" href="../../px-demo/px-demo-header.html" />
<link rel="import" href="../../px-demo/px-demo-api-viewer.html" />
<link rel="import" href="../../px-demo/px-demo-footer.html" />
<link rel="import" href="../../px-demo/px-demo-configs.html" />
<link rel="import" href="../../px-demo/px-demo-props.html" />
<link rel="import" href="../../px-demo/px-demo-interactive.html" />
<link rel="import" href="../../px-demo/px-demo-component-snippet.html" />
<link rel="import" href="../../px-demo/px-demo-code-editor.html" />

<!-- Imports for this component -->
<link rel="import" href="../../px-demo/css/px-demo-styles.html" />
<link rel="import" href="../px-data-grid.html" />

<!-- Demo DOM module -->
<dom-module id="px-data-grid-demo">
  <template>
    <style>
      .theme-switcher-checkbox {
        display: inline-flex;
        float: right;
        margin: 1rem 2rem;
      }

      .theme-switcher-checkbox input {
        margin-left: 5px;
      }

      .button-row {
        padding: 5px 0;
      }
    </style>
    <custom-style>
      <style include="px-demo-styles" is="custom-style"></style>
    </custom-style>

    <!-- Header -->
    <px-demo-header
        module-name="px-data-grid"
        description="The data grid displays tabular data with rich interactions to help users find, manage, and update important information. The px-data-grid component replaces the legacy px-data-table component and offers a wide range of new behaviors. The grid is complete rewrite with a new API and more features that targets Polymer 2+ runtime."
        mobile desktop tablet>
    </px-demo-header>

    <!-- Interactive -->
    <px-demo-interactive>
      <!-- Configs -->
      <px-demo-configs slot="px-demo-configs" configs="[[configs]]" props="{{props}}" chosen-config="{{chosenConfig}}"></px-demo-configs>

      <!-- Props -->
      <px-demo-props slot="px-demo-props" props="{{props}}" config="[[chosenConfig]]"></px-demo-props>

      <!-- Code Editor -->
      <px-demo-code-editor slot="px-demo-code-editor" props="{{props}}" config="[[chosenConfig]]"></px-demo-code-editor>

      <!-- Component ---------------------------------------------------------->
      <px-demo-component slot="px-demo-component">
        <px-data-grid
            columns="{{props.columns.value}}"
            table-data="{{props.tableData.value}}"
            striped="{{props.striped.value}}"
            multi-sort="{{props.multiSort.value}}"
            resizable="{{props.resizable.value}}"
            editable="{{props.editable.value}}"
            auto-filter="{{props.autoFilter.value}}"
            hide-selection-column="{{props.hideSelectionColumn.value}}"
            selection-mode="{{props.selectionMode.value}}"
            hide-action-menu="{{props.hideActionMenu.value}}"
            table-actions="{{props.tableActions.value}}"
            item-actions="{{props.itemActions.value}}"
            highlight="{{props.highlight.value}}"

            item-id-path="email"
            selected-items="{{selectedItems}}"
            on-table-action="handleTableAction"
            on-save-filters="saveFilterListener"
            on-item-action="_itemActionListener">
        </px-data-grid>
      </px-demo-component>
      <!-- END Component ------------------------------------------------------>

      <px-demo-component-snippet
          slot="px-demo-component-snippet"
          element-properties="{{props}}"
          element-name="px-data-grid"
          links-includes="[[linksIncludes]]"
          suppress-property-values='["tableData"]'>
      </px-demo-component-snippet>
    </px-demo-interactive>

    <!-- API Viewer -->
    <px-demo-api-viewer source="px-data-grid" api-source-file-path="px-data-grid-api.json"></px-demo-api-viewer>

    <!-- Footer -->
    <px-demo-footer></px-demo-footer>

  </template>

</dom-module>
<script>
  {
    /***************************************************************************
     * DEMO DATA
     */

    const demoTableDataNamesSmall = [
      {
        first: 'Elizabeth',
        last: 'Wong',
        email: 'sika@iknulber.cl',
        age: 23,
        born: '1995-04-12'
      },
      {
        first: 'Jeffrey',
        last: 'Wong',
        email: 'cofok@rac.be',
        age: 32,
        born: '1985-04-12',
      },
      {
        first: 'Alma',
        last: 'Martin',
        email: 'dotta@behtam.la',
        age: 44,
        born: '1973-04-12'
      },
      {
        first: 'Carl',
        last: 'Saunders',
        email: 'seh@bibapu.gy',
        age: 12,
        born: '2002-04-12'
      },
      {
        first: 'Willie',
        last: 'Dennis',
        email: 'izko@dahokwej.ci',
        age: 88,
        born: '1930-04-12'
      }
    ];

    const demoTableDataNamesLarge = [
      {
        first: 'Elizabeth',
        last: 'Wong',
        email: 'sika@iknulber.cl'
      },
      {
        first: 'Jeffrey',
        last: 'Hamilton',
        email: 'cofok@rac.be'
      },
      {
        first: 'Alma',
        last: 'Martin',
        email: 'dotta@behtam.la'
      },
      {
        first: 'Carl',
        last: 'Saunders',
        email: 'seh@bibapu.gy'
      },
      {
        first: 'Willie',
        last: 'Dennis',
        email: 'izko@dahokwej.ci'
      },
      {
        first: 'Angel',
        last: 'Lewis',
        email: 'ma@et.nz'
      },
      {
        first: 'Jessie',
        last: 'Sherman',
        email: 'hunocnas@mosuraj.gi'
      },
      {
        first: 'Eric',
        last: 'Brewer',
        email: 'tu@coajoul.de'
      },
      {
        first: 'Cory',
        last: 'Ramos',
        email: 'kilamja@oviafbek.ss'
      },
      {
        first: 'Bertie',
        last: 'Ross',
        email: 'ifuvu@getvi.my'
      },
      {
        first: 'Oscar',
        last: 'Estrada',
        email: 'minu@kerireg.gp'
      },
      {
        first: 'Estelle',
        last: 'Patton',
        email: 'hudliami@lijihen.fi'
      },
      {
        first: 'Sallie',
        last: 'George',
        email: 'wo@zof.bf'
      },
      {
        first: 'Harriett',
        last: 'Wheeler',
        email: 'woguw@cibevo.pt'
      },
      {
        first: 'Bryan',
        last: 'Houston',
        email: 'tekkubom@gaahu.ge'
      },
      {
        first: 'Leon',
        last: 'Craig',
        email: 'wo@gurozo.gs'
      },
      {
        first: 'Mable',
        last: 'Taylor',
        email: 'um@fegnocka.pg'
      },
      {
        first: 'Ida',
        last: 'Hansen',
        email: 'lufahu@gewlaskoc.kh'
      },
      {
        first: 'Adele',
        last: 'Thornton',
        email: 'gugugo@nevigi.th'
      },
      {
        first: 'Jerry',
        last: 'Kelley',
        email: 'solef@zoose.as'
      },
      {
        first: 'Clara',
        last: 'Delgado',
        email: 'fivticnuf@upkib.rw'
      },
      {
        first: 'Joseph',
        last: 'Stevenson',
        email: 'be@viijo.lk'
      },
      {
        first: 'Ellen',
        last: 'Perry',
        email: 'ce@jewo.sv'
      },
      {
        first: 'Ronnie',
        last: 'Cummings',
        email: 'iro@wi.vn'
      },
      {
        first: 'Olive',
        last: 'Santos',
        email: 'vo@nees.cn'
      },
      {
        first: 'Rena',
        last: 'Tucker',
        email: 'uharoc@lohpol.gl'
      },
      {
        first: 'Nell',
        last: 'Hicks',
        email: 'felaf@vo.sb'
      },
      {
        first: 'Jesus',
        last: 'Hawkins',
        email: 'wahgab@mu.mk'
      },
      {
        first: 'Duane',
        last: 'Harris',
        email: 'kellanjob@daava.ph'
      },
      {
        first: 'Jonathan',
        last: 'Holmes',
        email: 'jir@bikuf.dj'
      },
      {
        first: 'Christine',
        last: 'Collier',
        email: 'bocago@jerla.ba'
      },
      {
        first: 'Brandon',
        last: 'Thompson',
        email: 'regoh@ji.kn'
      },
      {
        first: 'Anne',
        last: 'Dunn',
        email: 'samhof@are.sc'
      },
      {
        first: 'Viola',
        last: 'Sherman',
        email: 'wep@kezori.lt'
      },
      {
        first: 'Kathryn',
        last: 'Harper',
        email: 'keotoci@je.mr'
      },
      {
        first: 'Calvin',
        last: 'Bates',
        email: 'bomeg@lip.bw'
      },
      {
        first: 'Maggie',
        last: 'Collins',
        email: 'zonefto@ihihij.ke'
      },
      {
        first: 'Zachary',
        last: 'Mitchell',
        email: 'wamez@cilvahbod.mk'
      },
      {
        first: 'Raymond',
        last: 'Kelley',
        email: 'wuz@napujos.tt'
      },
      {
        first: 'Augusta',
        last: 'Torres',
        email: 'bum@ne.lt'
      },
      {
        first: 'Charlie',
        last: 'Lindsey',
        email: 'ruhlu@tuobujen.ao'
      },
      {
        first: 'Jeremy',
        last: 'Swanson',
        email: 'ed@ted.km'
      },
      {
        first: 'Joel',
        last: 'Gonzalez',
        email: 'ej@pot.bz'
      },
      {
        first: 'Lillie',
        last: 'Hawkins',
        email: 'uguiv@mudbuve.pa'
      },
      {
        first: 'Joel',
        last: 'Watts',
        email: 'naafe@oli.bb'
      },
      {
        first: 'Isabella',
        last: 'Sandoval',
        email: 'asobu@wedef.af'
      },
      {
        first: 'Roy',
        last: 'Lyons',
        email: 'rasaogu@tadiri.tc'
      }
    ];

    /* Column definitions for the `demoTableDataNamesSmall` and `demoTableDataNamesLarge` datasets */
    const demoColumnsNames = [
      {
        name: 'First Name',
        path: 'first',
        renderer: 'px-data-grid-string-renderer',
        editable: true
      },
      {
        name: 'Last Name',
        path: 'last',
        renderer: 'px-data-grid-string-renderer',
        editable: true
      },
      {
        name: 'Email',
        path: 'email'
      }
    ];

    /* Highlight rules for the "Highlight rules" config */
    const demoHighlightNames = [
      {
        type: 'cell',
        color: 'lightgreen',
        condition: (cellContent, column, item) => {
          return cellContent == 'Dennis';
        }
      },
      {
        type: 'column',
        color: 'lightskyblue',
        condition: (column, item) => {
          return column.path == 'last';
        }
      },
      {
        type: 'row',
        color: 'lightsalmon',
        condition: (cellContent, item) => {
          return item && (item.last == 'Dennis' || item.first == 'Carl');
        }
      }
    ];

    /***************************************************************************
     * DEMO PROPS
     */

    const tableData = {
      type: Object,
      inputType: 'code:JSON',
      defaultValue: demoTableDataNamesSmall
    };

    const columns = {
      type: Object,
      inputType: 'code:JSON',
      defaultValue: demoColumnsNames
    };

    const striped = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const multiSort = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const editable = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const resizable = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const autoFilter = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const hideSelectionColumn = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const selectionMode = {
      type: String,
      inputType: 'dropdown',
      inputChoices: ['none', 'single', 'multi'],
      defaultValue: 'none',
      // @TODO: Figure out why px-demo initially sets selectionMode to something
      // other than 'none'. Setting the value here will only take effect when
      // the demo is initialized, and is overridden later.
      value: 'none'
    };

    const hideActionMenu = {
      type: Boolean,
      inputType: 'toggle',
      defaultValue: false
    };

    const tableActions = {
      type: Object,
      inputType: 'code:JSON',
      defaultValue: [
        {
          name: 'Export CSV',
          id: 'CSV'
        }
      ]
    };

    const itemActions = {
      type: Object,
      inputType: 'code:JSON',
      defaultValue: [
        {
          name: 'Add Row',
          id: 'add'
        },
        {
          name: 'Delete Row',
          id: 'delete'
        }
      ]
    };

    const highlight = {
      type: Array,
      inputType: 'code:EvaluatedJavaScript',
      defaultValue: [],
      // @TODO: Figure out why px-demo initially sets highlight to something
      // other than the default value. Setting the value here will only
      // take effect when the demo is initialized, and is overridden later.
      value: [],
      // @TODO: Fix px-demo to allow a prop to be hidden for default config,
      // this is required to hide a property on first page load.
      _visibleForConfig: false
    };

    // const gridHeight = {
    //   type: String,
    //   defaultValue: 'default',
    //   inputType: 'dropdown',
    //   inputChoices: ['default', 'auto', '300px', '600px', '900px']
    // };
    //
    // const offerFilterSaving = {
    //   type: Boolean,
    //   inputType: 'toggle',
    //   defaultValue: false
    // };
    //
    // const language = {
    //   type: String,
    //   inputType: 'dropdown',
    //   inputChoices: ['en', 'fr', 'fi'],
    //   defaultValue: 'en'
    // };
    //
    // const filterable = {
    //   type: Boolean,
    //   inputType: 'toggle',
    //   defaultValue: false
    // };
    //
    // const compactAdvancedFilterDialog = {
    //   type: Boolean,
    //   inputType: 'toggle',
    //   defaultValue: false
    // };
    //
    // const allowSortBySelection = {
    //   type: Boolean,
    //   inputType: 'toggle',
    //   defaultValue: false
    // };
    //
    // const columnReorderingAllowed = {
    //   type: Boolean,
    //   inputType: 'toggle',
    //   defaultValue: false
    // };

    const gridProps = {
      tableData,
      columns,
      striped,
      multiSort,
      resizable,
      editable,
      autoFilter,
      hideSelectionColumn,
      selectionMode,
      hideActionMenu,
      tableActions,
      itemActions,
      highlight
    };

    /***************************************************************************
     * DEMO CONFIGS
     */

    const defaultConfig = {
      configName: 'Default',
      configReset: true,
      configHideProps: ['highlight']
    };

    const moreDataConfig = {
      configName: 'More data',
      configReset: true,
      tableData: demoTableDataNamesLarge,
      configHideProps: ['highlight']
    };

    const highlightConfig = {
      configName: 'Hightlight rules',
      configReset: true,
      tableData: demoTableDataNamesSmall,
      highlight: demoHighlightNames
    };

    const gridConfigs = [
      defaultConfig,
      moreDataConfig,
      highlightConfig
    ];

    /***************************************************************************
     * DEMO COMPONENT
     */

    Polymer({
      is: 'px-data-grid-demo',

      properties: {
        props: {
          type: Object,
          value: () => gridProps
        },
        configs: {
          type: Array,
          value: () => gridConfigs
        }
      },

      /**
       * Called when the user selects an action from the table action menu.
       */
      handleTableAction(e) {
        if (e.detail.id === 'CSV') {
          this.exportToCsv();
        }
      },

      /**
       * Exports the grid data to a CSV. Demonstrates how an app would implement
       * this functionality.
       */
      exportToCsv() {
        const grid = this.shadowRoot ? this.shadowRoot.querySelector('px-data-grid') : this.querySelector('px-data-grid');
        const data = grid.getData();
        const columns = grid.getVisibleColumns();

        let csvContent = 'data:text/csv;charset=utf-8,';
        csvContent += columns.map((column) => grid.resolveColumnHeader(column)).join(',') + '\r\n';
        data.forEach((item) => {
          csvContent += Object.keys(item).map((key) => item[key]).join(',') + '\r\n';
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'table_data.csv');
        document.body.appendChild(link);

        link.click();
      }
    });
  }
</script>
